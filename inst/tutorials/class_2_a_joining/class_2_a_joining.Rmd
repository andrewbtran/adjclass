---
title: "Class 2: Joining data"
author: "Andrew Ba Tran"
output: 
  learnr::tutorial:
      theme: lumen
      highlight: espresso
      progressive: true
      allow_skip: false
      includes:
        before_body: _navbar.html
runtime: shiny_prerendered
# Do not index/display tutorial by setting `private: true`
private: true
description: >
  How to join data.
---

```{r setup, include=FALSE}
packages <- c("tidyverse", "lubridate", "rvest", "httr", "remotes")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
  install.packages(setdiff(packages, rownames(installed.packages())), repos = "https://cran.us.r-project.org")  
}

#remotes::install_github("rstudio/gradethis", upgrade="always", quiet=TRUE)
#remotes::install_github("rstudio/learnr", upgrade="always", quiet=TRUE)

library(tidyverse)
library(learnr)
library(gradethis)
library(lubridate)
library(readxl)
library(janitor)
#myurl <- "https://www.cdc.gov/nchs/data/data_acces_files/NCHSURCodes2013.xlsx"
#download.file(myurl, (tf1 <- tempfile(fileext = ".xlsx")), mode = "wb")

#designations <- readxl::read_excel(tf1)

county_pop <- read_csv("data/county_population.csv")
```

<span style="color:white">welcome to class!</span>

## Intro

We've done some basic exploring of the FEMA disaster declaration data. 

But there are only so many different ways to slice the data based on the variables in the original data set.

So we have to be creative and think of what other variables we can add.

Last time, we added some decades categories using the `case_when()` and `mutate()` functions.

But let's go even further by adding an additional data set.

Let's bring in county populatoin data from the U.S. Census so we can estimate how many people were affected by different disasters.

For this exercise, the data's already pre-loaded but these are the commands to bring it in yourself using the excellent package called [**tidycensus**](https://learn.r-journalism.com/en/mapping/static_maps/static-maps/) (you'll need to sub in your own Census [API key](https://api.census.gov/data/key_signup.html)). Usually, you'd have to search for and download this from data.census.gov and do some manual cleaning up before using. But using this package that interfaces with the Census API using the lines of code below gives you the data cleaned up and in a **tidy** format.

```{r tidycensus, eval=FALSE}
library(tidycensus)
census_api_key("API_KEY_GOES_HERE")

county_pop <- get_acs(geography="county", variables="B01003_001", year=2020)
```

Let's take a moment to talk about the significance of **tidy** data. It's the prefix to a lot of the packages and functions we're using in this class. But it's also a philosophy when approaching the structure of data.

...etc etc.

Let's take a look at the new `county_pop` data frame we imported from the Census API.

```{r glimpse_county_pop}
glimpse(county_pop)
```

Pay attention to the column names and what kind of data is in each column.

Next, let's take a look at our original FEMA data set.

```{r glimpse}
df <- read_csv("https://www.fema.gov/api/open/v2/DisasterDeclarationsSummaries.csv")

glimpse(df)
```

## Joins



## stringr

str_c

```{r str_c, eval=F}
df_narrow <- df_narrow %>% 
  mutate(GEOID=str_c(fipsStateCode, fipsCountyCode))

glimpse(df_narrow)
```

Hm, statewide ends with 000
Let's get rid of those
We know how to filter, but what about the equivalent of not equal to? !=

```{r nrow, eval=F}
nrow(df_narrow)
df_narrow <- df_narrow %>% 
  filter(fipsCountyCode!="000")
nrow(df_narrow)

```

Why is it "000" and not 000? Because if you glimpse(df_narrow), you'll see fipsCountyCode is considered a string, not a number
So quotes indicate these are a string and not a number


We went from 63032 to 61560

What's the percent change?

(new-old)/old

(61560-63032)/63032*100

dropped 2 percent. not that many relatively speaking

## joins


## math

### round

* Difference
* Percent
* Percent change
* Per Capita

## more on group_bys

* continguous
* continuous
  

## Class II - Part 2

Stop this tutorial in the `Render` tab of RStudio (press the stop button).

Congrats, you made it this far. You've earned a break.

Turn off your monitor and soak it all in.

When you're ready to move on to pt. 2 just type this in the console of RStudio:

```
learnr::run_tutorial("class_1_b_filter_select", "adjclass")
```
