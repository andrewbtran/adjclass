---
title: "Class 4: Statistics"
author: "Andrew Ba Tran"
output: 
  learnr::tutorial:
      theme: lumen
      highlight: espresso
      progressive: true
      allow_skip: false
      includes:
        before_body: _navbar.html
runtime: shiny_prerendered
# Do not index/display tutorial by setting `private: true`
private: true
description: >
  Brief statistical concepts
---


```{css, echo=FALSE}
.pageContent {
padding-top: 64px }
```

```{r setup, include=FALSE}
packages <- c("tidyverse", "lubridate", "rvest", "httr", "remotes",
            "stargazer", "tidymodels")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
  install.packages(setdiff(packages, rownames(installed.packages())), repos = "https://cran.us.r-project.org")  
}

#remotes::install_github("rstudio/gradethis", upgrade="always", quiet=TRUE)
#remotes::install_github("rstudio/learnr", upgrade="always", quiet=TRUE)

library(tidyverse)
library(learnr)
library(gradethis)
library(tidymodels)
library(stargazer)

gd_data = read_csv("https://glassdoor.box.com/shared/static/beukjzgrsu35fqe59f7502hruribd5tt.csv")


# Base pay summary stats.
gd_data_clean <-  gd_data %>%
  # Age brackets
  mutate(age_bin = cut(age,
                       breaks = c(0, 25, 35, 45, 55, Inf),
                       right = FALSE)) %>%
  # Total compensation
  mutate(total_pay = basePay + bonus) %>%
  # Log of compensation
  mutate(log_base = log(basePay, base = exp(1)),
         log_total = log(total_pay, base = exp(1)),
         # Adds 1 to allow for log of 0 bonus values.
         log_bonus = log(bonus + 1, base = exp(1))) %>%
  # Make flags
  mutate_if(is_character, fct_infreq) %>%
  mutate(age_bin = fct_infreq(age_bin))

# No controls. ("unadjusted" pay gap.)
lm_gender <- lm(log_base ~ gender, data = gd_data_clean)

# Adding "human capital" controls (performance evals, age and education).
lm_humancapital <- lm(log_base ~ gender + perfEval + age_bin + edu, data = gd_data_clean)

# Adding all controls. ("adjusted" pay gap.)
lm_allcontrols <- lm(log_base ~ gender + perfEval + age_bin + edu + dept + seniority + jobTitle, data = gd_data_clean)
```


```{css, echo=FALSE}
.pageContent {
padding-top: 64px }

.cell-left {
  text-align: left;
}

.cell-right {
  text-align: right;
}

.cell-center {
  text-align: center;
}

table {
    margin: auto;
    border-top: 1px solid rgb(102, 102, 102);
    border-bottom: 1px solid rgb(102, 102, 102);
    display: table;
    border-collapse: separate;
    box-sizing: border-box;
    border-spacing: 2px;
    border-color: grey;
    padding-bottom:5px;
}
```

<span style="color:white">welcome to class!</span>

## Descriptive statistics

You could spend a whole semester going over all the different statistical methods but there are a handful that are useful to journalists-- though there are more that are being used in stories in an effort to push the limit on data literacy. 

Let's work with some data of reviews I've scraped from Amazon: Scented candles.

```{r scented1}
candles <- read_csv("data/scented.csv")
```

In the past few modules you've learned how to do some of the basic statistical methods to summarize and describe the data.

### mean and median

Let's calculate the mean and median.

```{r mean_median}

```

### percent and rate

Okay, let's calculate the percent

```{r percent}

```

### standard deviation

And now the percent over time and the standard deviation

.png(https://miro.medium.com/max/1400/1*ojzbhJwvCyX5eYz9H2_d2g.png)

```{r percent_time_sd}

```


### percentiles and quantiles

### ratios, rates, andper capita

no example here, but we've done it before

### Check summary stats

please visualize your data, because summary statistics can tell you weird stuff.


## correlation

We're going to work with Amazon data!

Correlation between numeric variables can be investigated using the tidyverse corrr package. It allows you to compute correlations using Pearson, Kendall tau or Spearman rho. The package creates a table and also has a function to automatically plot the values.

Some authors consider a strong correlation over [.6, -.6] and over [.8/, -.8] is a very strong correlation. However, in this case, strong is over [.7, -.7]; while in this other is over [.5, -.5].

The second key was that “correlation does not mean causation.” And the third one was the variation of small samples. For another project I ran cor.test in R with only seven observations and, although the correlation coefficient was around .5, the results went from -.3 to .9.

```
correlation_tab <- linelist %>% 
  select(generation, age, ct_blood, days_onset_hosp, wt_kg, ht_cm) %>%   # keep numeric variables of interest
  correlate()      # create correlation table (using default pearson)

correlation_tab    # print
```

```
rplot(correlation_tab)

```

[#]https://corrr.tidymodels.org/articles/using-corrr.html

Interpreting the scores.



CORRELATION != CAUSATION

## Plot it

## How to phrase it in a story

"There is a strong relationship between X and Y."






## linear modeling

### Important to clean up data to work in a model


```{r glimpse, exercise=TRUE}
stargazer(gd_data_clean, type="text")
```

Linear regression
The base R function lm() perform linear regression, assessing the relationship between numeric response and explanatory variables that are assumed to have a linear relationship.

Provide the equation as a formula, with the response and explanatory column names separated by a tilde ~. Also, specify the dataset to data =. Define the model results as an R object, to use later.

```{r star, exercise=TRUE}
# No controls. ("unadjusted" pay gap.)
lm_gender <- lm(log_base ~ gender, data = gd_data_clean)

lm_gender
```

```{r star2, exercise=TRUE}
# Adding "human capital" controls (performance evals, age and education).
lm_humancapital <- lm(log_base ~ gender + perfEval + age_bin + edu, data = gd_data_clean)

lm_humancapital
```

```{r star3, exercise=TRUE}
# Adding all controls. ("adjusted" pay gap.)
lm_allcontrols <- lm(log_base ~ gender + perfEval + age_bin + edu + dept + seniority + jobTitle, data = gd_data_clean)

lm_allcontrols
```

```{r stargazer}
stargazer(lm_gender, lm_humancapital, lm_allcontrols, type="text", single.row=TRUE)
```

## Crosstabs


